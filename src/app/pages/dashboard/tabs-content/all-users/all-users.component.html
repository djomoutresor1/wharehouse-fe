<nz-breadcrumb>
  <nz-breadcrumb-item (click)="handleOnNavigate('dashboard')">
    <i nz-icon nzType="dashboard"></i>
    <a>Dashboard</a>
  </nz-breadcrumb-item>
  <nz-breadcrumb-item>
    <a>All users</a>
  </nz-breadcrumb-item>
  <nz-breadcrumb-item>
   <a><button nz-button (click)="onExportExcellFile()" [nzType]="'primary'">export excell Data</button></a> 
  </nz-breadcrumb-item>
</nz-breadcrumb>
<div class="warehouse-users-wrapper container-fluid">
  <div class="row" *ngIf="isAuth">
    <div class="col">
      <warehouse-notification [typeNotification]="alertType" [messageNotification]="messageAlert">
      </warehouse-notification>
    </div>
  </div>
  <div [formGroup]="searchForm" class="row warehouse-users-filter">
    <div class="col-md-4 offset-md-8 mb-2">
      <nz-form-label></nz-form-label>
      <nz-form-item>
        <nz-form-control>
          <nz-input-group nzPrefixIcon="search" [nzSuffix]="inputClearTpl">
            <input type="text" [(ngModel)]="search" nz-input formControlName="search"
              [placeholder]="'dashboard.dataTable.options.search.simple' | translate" (input)="handleOnSearchUsers()" />
          </nz-input-group>
          <ng-template #inputClearTpl>
            <i nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle" *ngIf="search"
              (click)="handleOnSearchClear()"></i>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>
  <nz-collapse [nzExpandIconPosition]="'left'">
    <nz-collapse-panel [nzHeader]="'dashboard.dataTable.options.search.advanced' | translate" [nzActive]="false"
      [nzExtra]="collapseContent" [nzDisabled]="false">
      <div [formGroup]="searchForm" class="row warehouse-not-margin warehouse-users-filter">
        <div class="col-md-2">
          <nz-form-label nzFor="typeEmailVerification">{{"verifyEmail.title" | translate }}
          </nz-form-label>
          <nz-form-item>
            <nz-form-control>
              <nz-select [(ngModel)]="selectedTypeEmail" [nzCustomTemplate]="typeEmailTemplate"
                [nzPlaceHolder]="'dashboard.dataTable.status.placeholder'| translate"
                formControlName="typeEmailVerification" (ngModelChange)="handleOnSearchUsers()">
                <nz-option nzCustomContent *ngFor="let typeEmailVerification of listOfTypeEmailVerification"
                  [nzValue]="typeEmailVerification?.value" [nzLabel]="typeEmailVerification?.label">
                  <span class="profile-verified" *ngIf="typeEmailVerification?.value !== 'all'"
                    [ngClass]="typeEmailVerification?.value ? 'warehouse-background-success' : 'warehouse-background-tomato'">
                    <i nz-icon nzType="{{typeEmailVerification?.value ? 'check-circle' : 'close-circle'}}"
                      nzTheme="outline"></i>
                  </span>
                  {{typeEmailVerification?.label}}
                </nz-option>
              </nz-select>
              <ng-template #typeEmailTemplate let-selected>
                <span class="profile-verified" *ngIf="selected?.nzValue !== 'all'"
                  [ngClass]="selected?.nzValue ? 'warehouse-background-success' : 'warehouse-background-tomato'">
                  <i nz-icon nzType="{{selected?.nzValue ? 'check-circle' : 'close-circle'}}" nzTheme="outline"></i>
                </span>
                {{ selected.nzLabel }}
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-2">
          <nz-form-label nzFor="role">{{"register.role.title" | translate }}
          </nz-form-label>
          <nz-form-item>
            <nz-form-control>
              <nz-select [(ngModel)]="selectedRole" [nzCustomTemplate]="roleTemplate"
                [nzPlaceHolder]="'register.role.placeholder'| translate" formControlName="role"
                (ngModelChange)="handleOnSearchUsers()">
                <nz-option nzCustomContent *ngFor="let role of listOfRoles" [nzValue]="role?.value"
                  [nzLabel]="role?.label">
                  <nz-tag *ngIf="role.value !== 'all'" [nzColor]="getUserColorRole(role?.value)">
                    <i nz-icon [nzType]="getUserRoleIcon(role?.value)"></i>
                  </nz-tag>
                  {{ role?.label }}
                </nz-option>
              </nz-select>
              <ng-template #roleTemplate let-selected>
                <nz-tag *ngIf="selected?.nzValue !== 'all'" [nzColor]="getUserColorRole(selected?.nzValue)">
                  <i nz-icon [nzType]="getUserRoleIcon(selected?.nzValue)"></i>
                </nz-tag>
                {{ selected.nzLabel }}
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-2">
          <nz-form-label nzFor="status">{{"profile.status" | translate }}
          </nz-form-label>
          <nz-form-item>
            <nz-form-control>
              <nz-select [(ngModel)]="selectedStatus" [nzCustomTemplate]="statusTemplate"
                [nzPlaceHolder]="'dashboard.dataTable.status.placeholder'| translate" formControlName="status"
                (ngModelChange)="handleOnSearchUsers()">
                <nz-option nzCustomContent *ngFor="let status of listOfStatus" [nzValue]="status?.value"
                  [nzLabel]="status?.label">
                  <nz-badge [nzStatus]="status?.style"></nz-badge>
                  {{ status?.label }}
                </nz-option>
              </nz-select>
              <ng-template #statusTemplate let-selected>
                <nz-badge [nzStatus]="getUserStatusSelected(selected?.nzValue)"></nz-badge>
                {{ selected.nzLabel }}
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div class="row warehouse-not-margin">
        <div class="col-md-1">
          <button nz-button nzType="primary" class="mt-2" (click)="handleOnResetFilter()">
            <i nz-icon nzType="clear" nzTheme="outline"></i>
            {{ "dashboard.dataTable.options.reset" | translate }}
          </button>
        </div>
      </div>
    </nz-collapse-panel>
  </nz-collapse>
  <ng-template #collapseContent>
    <!-- You can use stopPropagation if you don't want the panel to toggle -->
    <i nz-icon nzType="search" (click)="$event.stopPropagation()"></i>
  </ng-template>
  <div class="row mt-4">
    <nz-table #rowSelectionTable nzShowSizeChanger [nzData]="allUsers"
      (nzCurrentPageDataChange)="onCurrentPageDataChange($event)">
      <thead>
        <tr>
          <!-- <th [nzSelections]="listOfSelection" [(nzChecked)]="checked" [nzIndeterminate]="indeterminate"
            (nzCheckedChange)="onAllChecked($event)"></th> -->
          <th>{{ "profile.personalData.userId" | translate }}</th>
          <!-- <th>{{ "register.username.title" | translate }}</th>
          <th>{{ "register.gender.placeholder" | translate }}</th> -->
          <th>{{ "profile.personalData.fullname" | translate }}</th>
          <th>{{ "register.email.placeholder" | translate }}</th>
          <th>{{ "verifyEmail.title" | translate }}</th>
          <th>{{ "profile.roles" | translate }}</th>
          <th>{{ "profile.status" | translate }}</th>
          <th>{{ "profile.personalData.dateOfBorn" | translate }}</th>
          <th>{{ "profile.lastLogin" | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of rowSelectionTable.data">
          <!-- <td [nzChecked]="setOfCheckedId.has(data.id)" (nzCheckedChange)="onItemChecked(data.id, $event)"></td> -->
          <td><b>{{ data.user.userId }}</b></td>
          <!-- <td>{{ data.user.username }}</td>
          <td>{{ data.user.gender }}</td> -->
          <td>{{ data.user.fullname }}</td>
          <td>{{ data.user.email }}</td>
          <td>
            <span class="profile-verified"
              [ngClass]="data.user?.active ? 'warehouse-background-success' : 'warehouse-background-tomato'">
              <i nz-icon nzType="{{data.user?.active ? 'check-circle' : 'close-circle'}}" nzTheme="outline"></i>
              {{(data.user?.active ? "profile.verified" : "profile.notVerified") | translate}}
            </span>
          </td>
          <td>
            <nz-tag *ngFor="let role of data.user.roles" [nzColor]="getUserColorRole(role)">
              <i nz-icon [nzType]="getUserRoleIcon(role)"></i>
              {{ getUserRoleName(role)}}
            </nz-tag>
          </td>
          <td class="text-center">
            <nz-badge nz-tooltip nzTooltipTitle="{{formatUserStatus(data.userInfo.status)}}"
              nzTooltipPlacement="bottomLeft" nzStatus="{{ getUserStatus(data.userInfo.status) }}"></nz-badge>
          </td>
          <td>{{ data.user.dateOfBirth }}</td>
          <td>{{ data.user.lastLogin }}</td>
          <td>
            <button nz-button nz-dropdown [nzDropdownMenu]="options" nzType="primary">
              {{ "dashboard.dataTable.options.title" | translate }}
              <i nz-icon nzType="down"></i>
            </button>
            <nz-dropdown-menu #options="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item (click)="handleOnStatus(data)"><i nz-icon nzType="right-circle" nzTheme="twotone"></i>
                  {{
                  "dashboard.dataTable.options.status" |
                  translate }}</li>
                <li nz-menu-item (click)="handleOnShow(data.user)"><i nz-icon nzType="eye" nzTheme="twotone"></i> {{
                  "dashboard.dataTable.options.show" |
                  translate }}</li>
                <li nz-menu-item (click)="handleOnEdit(data.user)"><i nz-icon nzType="edit" nzTheme="twotone"></i> {{
                  "dashboard.dataTable.options.edit" |
                  translate }}</li>
                <li nz-menu-item (click)="handleOnDelete(data.user)"><i nz-icon nzType="delete" nzTheme="twotone"></i>
                  {{
                  "dashboard.dataTable.options.delete" | translate }}</li>
              </ul>
            </nz-dropdown-menu>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
  <div class="row">
    <div class="col">
      <nz-drawer [nzWidth]="sizeDrawer" [nzVisible]="visibleDrawerShow" nzPlacement="right" [nzTitle]="titleDrawer"
        (nzOnClose)="handleOnCloseDrawer()">
        <ng-container *nzDrawerContent>
          <warehouse-profile [mode]="mode" [user]="userDatatable"></warehouse-profile>
        </ng-container>
      </nz-drawer>
      <nz-drawer *ngIf="userDatatable" [nzClosable]="false" [nzVisible]="visibleDrawerStatus" nzPlacement="right"
        [nzTitle]="titleDrawer" [nzFooter]="nzDrawerFooter" (nzOnClose)="handleOnCloseDrawer()">
        <ng-container *nzDrawerContent>
          <p>{{ "operation.confirmation.change.firstText" | translate }} <b>{{userDatatable.userId }}</b>{{
            "operation.confirmation.change.secondText" | translate }} <b
              class="warehouse-tomato">{{formatUserStatus(userDatatable.userInfo.status)}}</b></p>
          <p>{{"operation.confirmation.change.thirdText" | translate }} </p>
          <nz-radio-group [(ngModel)]="userStatusSelected">
            <label nz-radio [nzDisabled]="userDatatable.userInfo.status === 'active'" nzValue="active">{{
              "dashboard.dataTable.status.active" | translate }}</label>
            <label nz-radio [nzDisabled]="userDatatable.userInfo.status === 'pending'" nzValue="pending">{{
              "dashboard.dataTable.status.pending" | translate }}</label>
            <label nz-radio [nzDisabled]="userDatatable.userInfo.status === 'disabled'" nzValue="disabled">{{
              "dashboard.dataTable.status.disabled" | translate }}</label>
          </nz-radio-group>
        </ng-container>
        <ng-template #nzDrawerFooter>
          <div style="float: right">
            <button nz-button style="margin-right: 8px;" (click)="handleOnCloseDrawer()"><i nz-icon nzType="left"
                nzTheme="outline"></i> {{ "dashboard.cta.back" | translate }}</button>
            <button nz-button nzType="primary" [disabled]="userStatusSelected === userDatatable.userInfo.status"
              (click)="handleOnChangeStatus()"><i nz-icon nzType="check-circle" nzTheme="outline"></i> {{
              "dashboard.cta.edit" | translate }}</button>
          </div>
        </ng-template>
      </nz-drawer>
    </div>
  </div>
</div>